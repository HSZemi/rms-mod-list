<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Map Mods | Siege Engineers</title>
    <link rel="stylesheet" href="css/bulma.min.css">
    <style>
        .card {margin-bottom: 1rem;}
    </style>
</head>
<body>
<section class="hero is-success is-bold">
    <div class="hero-body">
        <div class="container">
            <h1 class="title is-2">
                <img src="img/SiegeEngineers.png" alt="Siege Engineers"/> Map Mods
            </h1>
            <p class="subtitle">
                Age of Empires II DE map mods list – Last Update: <span id="last-update">…</span>
            </p>
        </div>
    </div>
</section>
<section class="section">
    <div class="container content">
        <div class="columns">
            <div class="column ">
                <input class="input is-rounded" type="text" id="filter" placeholder="Filter...">
            </div>
        </div>
    </div>
    <div class="container" id="list-of-maps">
        <progress class="progress is-large is-success" max="100">60%</progress>
    </div>
</section>
<script type="text/javascript">
    const applyFilter = () => {
        const input = document.getElementById('filter');
        const filter = input.value.toLowerCase();
        const modElements = document.getElementsByClassName('mods');
        for (let singleMod of modElements) {
            const text = singleMod.textContent;
            if(text.toLowerCase().indexOf(filter) > -1){
                singleMod.classList.remove('is-hidden');
            } else {
                singleMod.classList.add('is-hidden');
            }
        }
    };

    const init = (filename) => {
        fetch(filename)
            .then(response => response.json())
            .then(json => {
                const modList = json.modList;
                const units_buildings_content = document.getElementById('list-of-maps');
                units_buildings_content.innerHTML = '';
                for (let mod of modList) {
                    const node = document.createElement('div');
                    node.id = `mod-${mod.modId}`;
                    node.classList.add('mods');
                    node.innerHTML = modToDiv(mod);
                    units_buildings_content.appendChild(node);
                }
                document.getElementById('last-update').innerText = json.lastUpdate;
                applyFilter();
            });
    };

    const modToDiv = (mod) => {
        return `<div class="card">
    <div class="card-content">
        <div class="columns">
            <div class="column is-one-fifth">
                <figure class="image is-16by9">
                    <img loading="lazy" src="${mod.thumbnail}">
                </figure>
            </div>
            <div class="column">
                <h3 class="title is-4">${mod.modName}</h3>
                <h4 class="title is-6">by ${mod.creatorName}</h4>
                <p>${mod.modDescription}</p>
            </div>
        </div>
    </div>
    <footer class="card-footer">
        <a href="${mod.downloadUrl}" class="card-footer-item">Download (${(mod.modFileSize / 1024 / 1024).toFixed(1)} MiB)</a>
        <a href="https://www.ageofempires.com/mods/details/${mod.modId}/" class="card-footer-item">View on
            ageofempires.com</a>
        <p class="card-footer-item">
            <span class="tag is-danger">${mod.likes.toLocaleString('en-US')} Likes</span>
               &emsp;
            <span class="tag is-info">${mod.downloads.toLocaleString('en-US')} Downloads</span>
        </p>
    </footer>
</div>`;
    }

    document.getElementById('filter').addEventListener('keyup', function (e) {
        if (e.key === "Escape") {
            document.getElementById('filter').value = '';
        }
        applyFilter();
    });

    init("data/all_the_maps.json");
</script>
<footer class="footer">
    <div class="container content has-text-grey-light is-size-7">
        <p>Made by <a href="https://aoe2.se" rel="author" class="has-text-grey">Siege Engineers</a>. You can contribute
            to this project on <a href="https://github.com/SiegeEngineers/halfon" rel="nofollow" class="has-text-grey">GitHub</a>.
        </p>
        <p>Age of Empires II &copy; Microsoft Corporation.<br/>
            <b>Halfon</b> was created under Microsoft's "<a href="https://www.xbox.com/en-us/developers/rules"
                                                            rel="nofollow" class="has-text-grey">Game Content Usage
                Rules</a>" using assets from Age of Empires II, and it is not endorsed by or affiliated with Microsoft.
        </p>
    </div>
</footer>
</body>
</html>
